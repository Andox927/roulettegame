{% extends "base.html" %}

{% block title %}å¾Œå°è¨­å®š{% endblock %}
{% block body_class %}backend-page{% endblock %}

{% block content %}
<div class="page">
  <div class="phone backend">
    <div class="header">
      <div class="title">å¾Œå°è¨­å®š</div>
      <div class="header-actions">
        <a class="btn ghost" href="/">å›åˆ°å‰å°</a>
        <a class="btn ghost" href="/logout/">ç™»å‡º</a>
      </div>
    </div>

    <div class="field">
      <label class="field-label accent">å·²å­˜æŠ½çå…§å®¹</label>
      <div class="select-row">
        <select id="backend-config" class="select wide">
          {% for config in configs %}
            <option value="{{ config.id }}" {% if selected and config.id == selected.id %}selected{% endif %}>{{ config.name }}</option>
          {% endfor %}
        </select>
        <button id="load-config" class="btn teal" type="button">è¼‰å…¥</button>
      </div>
    </div>

    <div class="table-head">
      <span>çé …åç¨±</span>
      <span>æ©Ÿç‡</span>
      <span>æ“ä½œ</span>
    </div>

    <form method="post" class="backend-form">
      {% csrf_token %}
      <input type="hidden" name="config_id" value="{{ selected.id|default:'' }}" />

      <div id="prize-rows" class="prize-rows">
        {% if prizes %}
          {% for prize in prizes %}
          <div class="row">
            <input class="input" name="prize_name" value="{{ prize.name }}" placeholder="çé …åç¨±" />
            <input class="input prob" name="prize_prob" value="{{ prize.probability }}" placeholder="%" />
            <button class="btn-icon add" type="button">ï¼‹</button>
            <button class="btn-icon remove" type="button">ï¼</button>
          </div>
          {% endfor %}
        {% else %}
          <div class="row">
            <input class="input" name="prize_name" placeholder="çé …åç¨±" />
            <input class="input prob" name="prize_prob" placeholder="%" />
            <button class="btn-icon add" type="button">ï¼‹</button>
            <button class="btn-icon remove" type="button">ï¼</button>
          </div>
        {% endif %}
      </div>

      <div class="note">åƒ…å‰©ä¸€æ ¼çé …æ™‚ï¼Œåƒ…é¡¯ç¤ºç¶ è‰²ï¼‹</div>

      <div class="field">
        <label class="field-label">æŠ½çå…§å®¹å‘½å</label>
        <input class="input" name="config_name" value="{{ selected.name|default:'' }}" placeholder="ä¾‹ï¼š2026 æ˜¥å­£æ´»å‹•" />
      </div>

      <button class="btn save" type="submit">å­˜æª”</button>
    </form>

    <div class="history-block">
      <button id="history-toggle" class="btn ghost" type="button">è®€å–æŠ½çæ­·å²</button>
      <ul id="activity-list" class="activity-list hidden">
        {% for activity in activity_list %}
          <li>
            <a href="/backend/?activity={{ activity.activity_name }}">{{ activity.activity_name }}</a>
            <span class="activity-actions">
              <span class="muted">{{ activity.created_at|date:"Y-m-d" }}</span>
              <button class="icon-trash" type="button" data-activity="{{ activity.activity_name }}" aria-label="åˆªé™¤">ğŸ—‘</button>
            </span>
          </li>
        {% empty %}
          <li class="muted">å°šç„¡æ­·å²</li>
        {% endfor %}
      </ul>
    </div>

    {% if activity_detail %}
      <div id="history-detail" class="history-detail" data-activity="{{ activity_detail.activity_name }}">
        <div class="history-title">æ´»å‹•ï¼š{{ activity_detail.activity_name }}</div>
        <ul class="history-list">
          {% for item in activity_history %}
            <li>{{ item.drawn_at|date:"H:i" }}  {{ item.nickname }} - {{ item.prize_name }}</li>
          {% empty %}
            <li class="muted">å°šç„¡ç´€éŒ„</li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/backend.js"></script>
{% endblock %}
